<UserControl x:Class="Linear_Programming_Calculator_Desktop.Views.EquationInputView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Linear_Programming_Calculator_Desktop.Views" xmlns:conv="clr-namespace:Linear_Programming_Calculator_Desktop.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <conv:IsMaximizationConverter x:Key="isMaximizationConverter"/>
            <conv:ConstraintTypeToSignConverter x:Key="constraintTypeToSignConverter"/>
            <conv:IsNotLastItemConverter x:Key="isNotLastItemConverter"/>
            
            <DataTemplate x:Key="SimpleInputTemplate">
                <StackPanel Orientation="Horizontal" Margin="2">
                    <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                     Width="60" Margin="4,0"
                     HorizontalContentAlignment="Right" />
                    <Label Content="{Binding Label}" VerticalAlignment="Center" />
                    <Label Content="+"
                       Margin="2,0"
                       VerticalAlignment="Center">      
                        <Label.Visibility>
                            <MultiBinding Converter="{StaticResource isNotLastItemConverter}">
                                <Binding RelativeSource="{RelativeSource AncestorType=ContentPresenter}" Path="(ItemsControl.AlternationIndex)" />
                                <Binding RelativeSource="{RelativeSource AncestorType=ItemsControl}" Path="Items.Count" />
                            </MultiBinding>
                        </Label.Visibility>
                    </Label>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="ConstraintInputTemplate">
                <StackPanel Orientation="Horizontal" Margin="2">
                    <ItemsControl ItemsSource="{Binding ConstraintValues}"
                          ItemTemplate="{StaticResource SimpleInputTemplate}" AlternationCount="100">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>

                    <ComboBox SelectedValue="{Binding ConstraintType, Mode=TwoWay, Converter={StaticResource constraintTypeToSignConverter}}"
                              SelectedValuePath="Content"
                      Width="60" Margin="10,0">
                        <ComboBoxItem Content="≥"/>
                        <ComboBoxItem Content="≤"/>
                        <ComboBoxItem Content="="/>
                    </ComboBox>

                    <TextBox Text="{Binding RightSideValue, UpdateSourceTrigger=PropertyChanged}"
                     Width="60" Margin="4,0"
                     HorizontalContentAlignment="Right"/>
                </StackPanel>
            </DataTemplate>

                <ResourceDictionary.MergedDictionaries>
                    <ResourceDictionary Source="../Styles/LinearProgStyle.xaml"/>
                </ResourceDictionary.MergedDictionaries>
            </ResourceDictionary>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Margin="10" Orientation="Vertical" DataContext="{Binding}">
                <TextBlock Text="Цільова функція:" FontWeight="Bold" Margin="0,0,0,6"/>
                <StackPanel Orientation="Horizontal">
                    <ItemsControl ItemsSource="{Binding ObjectiveFunctionValues}"
                      ItemTemplate="{StaticResource SimpleInputTemplate}"
                      Margin="0,0,6,0"
                      AlternationCount="100">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>

                    <TextBlock Text="→" VerticalAlignment="Center" Margin="5,0" FontSize="16"/>

                    <ComboBox Width="100"
                          SelectedIndex="{Binding IsMaximization, Converter={StaticResource isMaximizationConverter}}">
                        <ComboBoxItem Content="max"/>
                        <ComboBoxItem Content="min"/>
                    </ComboBox>
                </StackPanel>



                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                    </Grid.RowDefinitions>
                    <Button Content="Змінити задачу"
                        Command="{Binding NewProblemCommand}"
                        Grid.Column="0" Width="100"/>
                    <Button Content="Розв'язати"
                        Command="{Binding SolveCommand}"
                        Grid.Column="2" Height="25" Width="100"/>
                </Grid>
            </StackPanel>

            <Border Grid.Row="1" Background="#FFFFF0" CornerRadius="5" BorderThickness="1" BorderBrush="#FFD966" Padding="10">
                <StackPanel>
                    <TextBlock Text="Обмеження" FontWeight="Bold" Margin="0,0,0,10"/>
                    <ItemsControl ItemsSource="{Binding ConstraintValues}" 
                        ItemTemplate="{StaticResource ConstraintInputTemplate}" />
                    <CheckBox
                    Content="{Binding IntegerVariablesText}"
                    IsChecked="{Binding IntegerCheck}" Margin="0,5"/>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>
